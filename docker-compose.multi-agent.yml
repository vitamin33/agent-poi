# Agent PoI - Multi-Agent Gateway
# Runs all 3 agents (Alpha/Beta/Gamma) in a single process on port 10000
#
# Usage:
#   1. Generate wallets: ./scripts/generate-agent-wallets.sh
#   2. Start gateway: docker compose -f docker-compose.multi-agent.yml up --build -d
#   3. Watch A2A interactions: curl http://localhost:10000/alpha/a2a/interactions
#   4. Check network: curl http://localhost:10000/network
#   5. Run certifications: curl -X POST http://localhost:10000/alpha/certify

services:
  agent-gateway:
    build:
      context: ./agent
      dockerfile: Dockerfile
    container_name: poi-multi-agent
    ports:
      - "10000:10000"
    environment:
      - MULTI_AGENT=true
      - PORT=10000
      # SOLANA_RPC_URL from .env (QuickNode devnet)
      - PROGRAM_ID=EQ2Zv3cTDBzY1PafPz2WDoup6niUv6X8t9id4PBACL38
      - LLM_JUDGE_ENABLED=true
      - LLM_JUDGE_PROVIDER=anthropic
      - LLM_JUDGE_MODEL=claude-haiku-4-5-20251001
    env_file:
      - ./agent/.env
    volumes:
      - ./agent/wallets:/app/wallets:ro
    healthcheck:
      test: ["CMD", "python", "-c", "import httpx; httpx.get('http://localhost:10000/health')"]
      interval: 30s
      timeout: 10s
      start_period: 30s
      retries: 3
    restart: unless-stopped
    networks:
      - poi-network

networks:
  poi-network:
    driver: bridge
